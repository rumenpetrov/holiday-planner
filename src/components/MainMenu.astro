---
import { getLangFromUrl, useTranslations } from "@i18n/utils";
import Link from "@components/Link.astro";

export interface Props {
  class?: string;
}

const { class: className, ...rest } = Astro.props;
const locale = getLangFromUrl(Astro.url);
const t = useTranslations(locale);
---

<nav
  {...rest}
  class:list={[className]}
  aria-label={t("GLOBAL.PRIMARY_NAVIGATION_LABEL")}
>
  <ul>
    <li>
      <Link href="/" asButton class="menu-link">{t("PAGES.HOME.TITLE")}</Link>
    </li>
    <li>
      <Link href="/this-year/" asButton class="menu-link">
        {t("PAGES.THIS_YEAR.TITLE")}
      </Link>
    </li>
    <li>
      <Link href="/next-year/" asButton class="menu-link">
        {t("PAGES.NEXT_YEAR.TITLE")}
      </Link>
    </li>
  </ul>
</nav>

<style>
  nav {
    position: fixed;
    bottom: 0;
    left: 0;
    z-index: var(--theme-z-index-fixed);
    width: 100%;
    border-top: var(--theme-border-size-m) solid var(--theme-palette-primary);
    overflow: auto;
    padding: var(--theme-space-size-400) 0;
    background-color: var(--theme-palette-secondary);
  }

  nav ul {
    display: flex;
    list-style-type: none;
    justify-content: center;
  }

  nav li .menu-link {
    display: block;
    padding: var(--theme-space-size-200) var(--theme-space-size-400);
    margin: 0 var(--theme-space-size-200);
    color: var(--theme-palette-primary-contrast);
    outline-width: var(--theme-space-size-100);
    outline-offset: 1px;
    outline-style: solid;
    outline-color: transparent;
    text-decoration: none;
    text-wrap: nowrap;
  }
  nav li .menu-link::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
    width: 100%;
    height: 100%;
    background-color: var(--theme-palette-primary);
    mask-image: var(--mask-scribble);
    mask-position: 50%;
    mask-size: 100% 100%;
  }

  nav li [aria-current="page"],
  nav li:hover .menu-link {
    outline-color: var(--theme-palette-primary);
  }

  @media (min-width: 1200px) {
    nav {
      position: relative;
      width: auto;
      border: 0;
      background-color: transparent;
      padding: var(--theme-space-size-200);
    }

    nav ul {
      flex-wrap: wrap;
    }
  }
</style>

<script>
  // document.addEventListener('astro:page-load', () => {
  const navLinks = document.querySelectorAll("nav a");

  navLinks.forEach((link) => {
    // link.classList.remove('active');
    link.removeAttribute("aria-current");

    const currentPath = window.location.pathname.replace(
      "/holiday-planner",
      "",
    );

    // `link.href` returns a whole url, such as: 'https://somedomain.com/posts/' and we only need the last part
    const hrefArray = link.href.split("/holiday-planner");
    const thisPath = hrefArray[hrefArray.length - 1];

    if (currentPath === thisPath) {
      // link.classList.add('active');
      link.setAttribute("aria-current", "page");
    }
  });
  // });
</script>
